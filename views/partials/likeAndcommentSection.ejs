<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .post-meta-section {
            background-color: #fafafa;
            transition: all 0.2s ease;
        }

        .post-meta-section:hover {
            background-color: #f5f5f5;
        }

        .author-avatar-link img {
            transition: transform 0.2s ease;
        }

        .author-avatar-link:hover img {
            transform: scale(1.05);
        }

        .author-name-link:hover {
            color: var(--bs-primary) !important;
        }

        .btn {
            transition: all 0.2s ease;
            border-width: 1.5px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .btn-outline-primary:hover {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: white;
        }

        .badge {
            font-family: inherit;
        }

        /* Orange theme integration */
        .btn-outline-danger {
            --bs-btn-color: #FF8C00;
            --bs-btn-border-color: #FF8C00;
        }

        .btn-outline-danger:hover {
            --bs-btn-hover-bg: #FF8C00;
            --bs-btn-hover-border-color: #E67E00;
        }

        .btn-danger {
            --bs-btn-bg: #FF8C00;
            --bs-btn-border-color: #FF8C00;
        }

        .btn-danger:hover {
            --bs-btn-hover-bg: #E67E00;
            --bs-btn-hover-border-color: #E67E00;
        }
    </style>
</head>
<body>
    <div>
    <%
        console.log('post',post);
        // Use res.locals.currentUser and res.locals.userId directly
        const postLiked = req.session.currentUserId && post.likes.some(like => like.authorId === req.session.currentUserId);
        const likeCount = post.likes.length;
        const commentCount = post._count.comments;

        const authorProfilePic = post.author && post.author.profilePictureUrl ? post.author.profilePictureUrl : '/images/default-avatar.png';
    %>

    <div class="post-meta-section p-3 border-bottom">
        <!-- Author Info and Actions Row -->
        <div class="d-flex align-items-center justify-content-between">
            <!-- Left side: Author profile -->
            <div class="d-flex align-items-center gap-3">
                <a href="/auth/profile/<%= post.authorId %>" class="author-avatar-link">
                    <img src="<%= authorProfilePic %>" 
                         alt="<%= post.author.name %>'s profile picture" 
                         class="rounded-circle border border-2 border-light shadow-sm" 
                         style="width: 45px; height: 45px; object-fit: cover;">
                </a>
                <div class="author-info">
                    <a href="/auth/profile/<%= post.authorId %>" 
                       class="author-name-link text-decoration-none text-dark fw-bold d-block" 
                       style="font-size: 0.95em; line-height: 1.2;">
                        <%= post.author.name %>
                    </a>
                    <small class="text-muted d-block" style="font-size: 0.8em;">
                        <%= post.createdAt.toLocaleString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric',
                            hour: 'numeric',
                            minute: '2-digit'
                        }) %>
                    </small>
                </div>
            </div>

            <!-- Right side: Like, Comment, and Read Time -->
            <div class="d-flex align-items-center gap-2">
                <!-- Like Button -->
                <form action="/posts/<%= post.id %>/toggle-like" method="POST" class="d-inline">
                    <% if (!req.session.currentUserId) { %>
                        <button type="button" 
                                class="btn btn-sm btn-outline-danger d-flex align-items-center gap-1 rounded-pill px-3 py-1"
                                data-bs-toggle="tooltip" 
                                data-bs-placement="top" 
                                title="Login to like this post">
                            <i class="bi bi-heart" style="font-size: 0.9em;"></i>
                            <span style="font-size: 0.85em; font-weight: 500;"><%= likeCount %></span>
                        </button>
                    <% } else { %>
                        <button type="submit" 
                                class="btn btn-sm d-flex align-items-center gap-1 rounded-pill px-3 py-1 <%= postLiked ? 'btn-danger' : 'btn-outline-danger' %>"
                                data-bs-toggle="tooltip" 
                                data-bs-placement="top" 
                                title="<%= postLiked ? 'Unlike this post' : 'Like this post' %>">
                            <i class="bi <%= postLiked ? 'bi-heart-fill' : 'bi-heart' %>" style="font-size: 0.9em;"></i>
                            <span style="font-size: 0.85em; font-weight: 500;"><%= likeCount %></span>
                        </button>
                    <% } %>
                </form>

                <!-- Comment Button -->
                <a href="/posts/<%= post.id %>#comments" 
                   class="btn btn-sm btn-outline-primary d-flex align-items-center gap-1 rounded-pill px-3 py-1"
                   data-bs-toggle="tooltip" 
                   data-bs-placement="top" 
                   title="View comments">
                    <i class="bi bi-chat" style="font-size: 0.9em;"></i>
                    <span style="font-size: 0.85em; font-weight: 500;"><%= commentCount %></span>
                </a>

                <!-- Read Time -->
                <span class="badge bg-light text-dark border px-2 py-1" 
                      style="font-size: 0.75em; font-weight: 500;">
                    <i class="bi bi-clock me-1"></i><%= post.readTime %>
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Initialize tooltips -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
</body>
</html>