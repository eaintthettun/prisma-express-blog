<!-- Horizontal scrollable nav that shows for you button and followedTopics button -->
<!--if currentUser exists,show scroll bar-->
<% if (currentUser) { %>
  <div class="topic-scrollbar bg-white py-3 border-bottom sticky-top" style="z-index: 0;">
    <div class="container position-relative">

      <!-- Scroll Arrows -->
      <button class="scroll-arrow left" onclick="scrollTopics(-200)">‹</button>
      <button class="scroll-arrow right" onclick="scrollTopics(200)">›</button>

    
      <!-- Scrollable Container -->
      <div id="scrollContainer" class="scroll-container d-flex gap-2 overflow-auto">
        <!-- Follow Topics Button -->
        <a href="/topics" title="Follow more topics">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 32 32">
                <path fill="#333" d="M16 32C7.163 32 0 24.837 0 16S7.163 0 16 0s16 7.163 16 16a16 16 0 0 1-16 16m0-30C8.268 2 2 8.268 2 16s6.268 14 14 14s14-6.268 14-14A14 14 0 0 0 16 2"/>
                <path fill="#333" d="M23 15h-6V9h-2v6H9v2h6v6h2v-6h6z" class="ouiIcon__fillSecondary"/>
            </svg>
        </a>

        <!-- Following Button -->
        <a href="/posts/following" 
           class="custom-feed-btn <%= activeTab === 'following' ? 'active' : '' %>">Following</a>

        <!-- Followed Categories -->
        <% if (followedCategories && followedCategories.length > 0) { %>
          <% followedCategories.forEach(f => { %>
            <a href="/categories/<%= f.category.slug %>" class="custom-feed-btn">
              <%= f.category.name %>
            </a>
          <% }) %>
        <% } %>

        <!-- Followed Topics -->
        <% if (followedTopics && followedTopics.length > 0) { %>
          <% followedTopics.forEach(f => { %>
            <a href="/topics/<%= f.topic.slug %>" class="custom-feed-btn">
              <%= f.topic.name %>
            </a>
          <% }) %>
        <% } %>


      </div>
    </div>
  </div>
<% } %>


<div class="container my-5">
        <% if (posts && posts.length > 0) { %>
            <% posts.forEach(post => { %>
                <div class="post-container post-item d-flex flex-column flex-md-row justify-content-between py-4 border-bottom">
                    <div class="post-content-column order-2 order-md-1 mb-3 mb-md-0 me-md-4 flex-grow-1">
                        <small class="post-category mb-2 d-block">
                            <!--if category exists,go to route.If not, go to #-->
                            <a 
                              href="<%= post.category && post.category.slug ? '/topics/' + post.category.slug : '#' %>" 
                              class="category-pill-link"
                            >
                              <%= post.category && post.category.name ? post.category.name : 'Uncategorized' %>
                            </a>

                        </small>
                        <h2 class="post-title fs-4 fw-bold mb-2">
                            <a href="/posts/<%= post.id %>" class="text-decoration-none text-dark">
                                <%= post.title %>
                            </a>
                        </h2>
                        <% if (post.subtitle) { %>
                            <p class="post-subtitle text-muted mb-2"><%= post.subtitle %></p>
                        <% } %>

                        <div class="mt-2">
                            <%- include('../partials/authorInfoBar',{post,currentUser,getReadTime})%>
                            <%- include('../partials/likeCommentBookmarkShare', { post: post, currentUser }) %>
                        </div>
                    </div>

                    <div class="post-image-column order-1 order-md-2 ms-md-auto">
                        <a href="/posts/<%= post.id %>">
                            <% if (post.imageUrl) { %>
                                <img src="<%= post.imageUrl %>" alt="<%= post.title %>" class="post-thumbnail">
                            <% } else { %>
                                <img src="/images/defaultPostImage.avif" alt="Default Post Image" class="post-thumbnail">
                            <% } %>
                        </a>
                    </div>
                </div>
            <% }); %>

            <nav aria-label="Page navigation for posts" class="pagination-section mt-5">
                <ul class="pagination justify-content-center">
                    <% if (hasPreviousPage) { %>
                    <li class="page-item">
                        <a class="page-link" href="?page=<%= previousPage %>">Previous</a>
                    </li>
                    <% } %>
                    <% for (let i = 1; i <= totalPages; i++) { %>
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                    </li>
                    <% } %>
                    <% if (hasNextPage) { %>
                    <li class="page-item">
                        <a class="page-link" href="?page=<%= nextPage %>">Next</a>
                    </li>
                    <% } %>
                </ul>
            </nav>
        <% } else { %>
              <!--if it clicks following button, isFollowingFeed will be true-->
              <% if(isFollowingFeed){ %>
                  <p class="no-posts-message text-center fs-5 text-muted">You haven't followed any authors or topics yet.</p>
              <%} else{ %> <!--simple all posts-->
                    <p class="no-posts-message text-center fs-5 text-muted">No posts to show yet. Check back soon!</p>
              <% } %>
        <% } %>
    </div>

<style>
  .scroll-container {
    display: flex;
    align-items: center;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    scroll-behavior: smooth;
}

.scroll-container::-webkit-scrollbar {
  display: none;
}

.custom-feed-btn {
  flex-shrink: 0;
  white-space: nowrap;
  border: 1px solid #ccc;
  padding: 6px 16px;
  border-radius: 50px;
  background: white;
  font-weight: 500;
  color: #333;
  text-decoration: none;
  transition: all 0.2s ease;
}

.custom-feed-btn:hover {
  background: #f8f9fa;
}

/* Scroll arrows */
    .scroll-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        background: white;
        border: 1px solid #ccc;
        border-radius: 50%;
        padding: 4px 10px;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .scroll-arrow.left {
        left: -10px;
    }

    .scroll-arrow.right {
        right: -10px;
    }

    .custom-feed-btn.active {
        background-color:rgb(59, 131, 115);
        color: #ffffff;
    }
</style>

<script>
  function scrollTopics(offset) {
    const container = document.getElementById('scrollContainer');
    container.scrollBy({ left: offset, behavior: 'smooth' });
  }
</script>
